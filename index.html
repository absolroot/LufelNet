<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>루페르넷</title>
    <link rel="stylesheet" href="./styles/common.css">
    <link rel="stylesheet" href="./styles/home.css">
    <link rel="icon" type="image/x-icon" href="./img/ui/favicon.ico?v=1.0.1">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5862324369257695"
     crossorigin="anonymous"></script>
    <script>document.write('<script src="./js/version.js?v=' + new Date().getTime() + '"><\/script>');</script>
</head>
<body>
    <div class="container">
        <!-- 네비게이션이 삽입될 컨테이너 -->
        <div id="nav-container"></div>

        <!-- 메인 컨텐츠 wrapper -->
        <div class="main-wrapper">
            <!-- 헤더 (로고 등) -->
            <div class="header-container">
                <h1>P5X 루페르넷</h1> <span class="beta-text">beta</span>
                <button class="music-control" id="musicControl">
                    <img src="./img/ui/music-off.png" alt="음악 재생" id="musicIcon">
                </button>
            </div>

            <!-- 메인 컨텐츠 -->
            <div class="main-content">
                <div class="menu-cards">
                    <div class="menu-card" onclick="location.href='./character/character.html'">
                        <div class="card-content">
                            <div class="text-section">
                                <h2>괴도 <img src="./img/home/icon1.png" alt="괴도 아이콘" class="title-icon"></h2>
                                <p class="desktop-description">보다 높은 점수, 보다 쉬운 클리어를 위한<br>괴도 별 육성 전략을 만나보세요</p>
                                <p class="mobile-description">괴도 별 육성 전략을 만나보세요</p>
                                <button onclick="location.href='./character/character.html'" class="view-more">바로가기 →</button>
                            </div>
                            <img src="./img/home/1.webp" alt="괴도 일러스트" class="card-illustration" loading="lazy">
                        </div>
                    </div>
                    
                    <div class="menu-card" onclick="location.href='./persona/persona.html'">
                        <div class="card-content">
                            <div class="text-section">
                                <h2>페르소나 <img src="./img/home/icon2.png" alt="페르소나 아이콘" class="title-icon"></h2>
                                <p class="desktop-description">핵심 페르소나 추천과 더불어<br>각 페르소나에 어울리는 스킬 세팅까지</p>
                                <p class="mobile-description">핵심 페르소나 추천과 스킬 세팅까지</p>
                                <button onclick="location.href='./persona/persona.html'" class="view-more">바로가기 →</button>
                            </div>
                            <img src="./img/home/2.webp" alt="페르소나 일러스트" class="card-illustration" loading="lazy">
                        </div>
                    </div>

                    <div class="menu-card" onclick="location.href='./revelations/revelations.html'">
                        <div class="card-content">
                            <div class="text-section">
                                <h2>계시 <img src="./img/home/icon3.png" alt="계시 아이콘" class="title-icon"></h2>
                                <p class="desktop-description">계시 정보들을 한 눈에!<br>속성별, 일월성진별 원하는 대로 매칭</p>
                                <p class="mobile-description">계시 정보들을 한 눈에!</p>
                                <button onclick="location.href='./revelations/revelations.html'" class="view-more">바로가기 →</button>
                            </div>
                            <img src="./img/home/3.webp" alt="계시 일러스트" class="card-illustration" loading="lazy">
                        </div>
                    </div>

                    <div class="menu-card" onclick="location.href='./tactic/tactic.html'">
                        <div class="card-content">
                            <div class="text-section">
                                <h2>택틱 <img src="./img/home/icon4.png" alt="택틱 아이콘" class="title-icon"></h2>
                                <p class="desktop-description">본인만의 택틱을 만들고 공유하고,<br>바다와 흉몽에서 높은 점수를 쟁취하세요</p>
                                <p class="mobile-description">본인만의 택틱을 만들고 공유하세요</p>
                                <button onclick="location.href='./tactic/tactic.html'" class="view-more">바로가기 →</button>
                            </div>
                            <img src="./img/home/4.webp" alt="택틱 일러스트" class="card-illustration" loading="lazy">
                        </div>
                    </div>
                </div>
                <div class="update-notice">
                    
                </div>
            </div>
            <div class="middle-container">
                <div class="popular-content">
                    <h2>인기 캐릭터</h2>
                    <div class="character-cards">
                        <div class="character-card">
                            <div class="character-card-img"><img src="./img/tier/아야카.webp" alt="아야카" onclick="location.href='./character/cha-detail.html?name=아야카'"></div>
                            <div class="character-card-text"><p>사카이 아야카</p></div>
                        </div>
                        <div class="character-card">
                            <div class="character-card-img"><img src="./img/tier/후타바.webp" alt="후타바" onclick="location.href='./character/cha-detail.html?name=후타바'"></div>
                            <div class="character-card-text"><p>사쿠라 후타바</p></div>
                        </div>
                        <div class="character-card">
                            <div class="character-card-img"><img src="./img/tier/리코·매화.webp" alt="리코·매화" onclick="location.href='./character/cha-detail.html?name=리코·매화'"></div>
                            <div class="character-card-text"><p>타네무라 리코·매화</p></div>
                        </div>
                        <div class="character-card">
                            <div class="character-card-img"><img src="./img/tier/루우나.webp" alt="루우나" onclick="location.href='./character/cha-detail.html?name=루우나'"></div>
                            <div class="character-card-text"><p>도겐자카 루우나</p></div>
                        </div>
                        <div class="character-card">
                            <div class="character-card-img"><img src="./img/tier/야오링·사자무.webp" alt="야오링·사자무" onclick="location.href='./character/cha-detail.html?name=야오링·사자무'"></div>
                            <div class="character-card-text"><p>리 야오링·사자무</p></div>
                        </div>
                        <div class="character-card">
                            <div class="character-card-img"><img src="./img/tier/카스미.webp" alt="카스미" onclick="location.href='./character/cha-detail.html?name=카스미'"></div>
                            <div class="character-card-text"><p>요시자와 카스미</p></div>
                        </div>

                    </div>
                </div>
                <div class="recent-update-content">
                    <h2>최신 업데이트</h2>
                    <div id="recent-update-list"></div>
                    <button id="show-more-updates-btn" class="show-more-updates-btn" style="display: none;">더보기</button>
                </div>
            </div>

            <div class="footer-container">
                <div class="footer-text">
                    <p>※ 루페르넷은 개인이 만든 비공식 페르소나5X 정보 제공 사이트로 게임의 콘텐츠와 소재의 트레이드마크와 저작권은 SEGA·ATLUS·Perfect World Games에 있습니다.</p>
                    <p>✉️ contact : superphil722@gmail.com　💬 discord : absolroot　@루트</p>
                    <p></p>
                </div>
                
                <!-- 반응형 일반 -->
                 <!--
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-5862324369257695"
                     data-ad-slot="1387076195"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>-->
            </div>
        </div>
        
    </div>

    <script src="./js/nav.js?v=1.0.1"></script>

    <!-- iframe 추가 -->
    <iframe id="music-player" src="music.html" style="display: none;"></iframe>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            Navigation.load('home', 0);
            VersionChecker.check();

            const musicPlayer = document.getElementById('music-player');
            const musicControl = document.getElementById('musicControl');
            const musicIcon = document.getElementById('musicIcon');
            let isPlaying = false;

            // 음악 컨트롤 버튼 클릭 이벤트
            musicControl.addEventListener('click', () => {
                if (!isPlaying) {
                    musicPlayer.contentWindow.postMessage('play', '*');
                    musicIcon.src = './img/ui/music-on.png';
                    musicIcon.alt = '음악 중지';
                } else {
                    musicPlayer.contentWindow.postMessage('pause', '*');
                    musicIcon.src = './img/ui/music-off.png';
                    musicIcon.alt = '음악 재생';
                }
                isPlaying = !isPlaying;
            });

            // 음악 상태 수신
            window.addEventListener('message', (event) => {
                if (event.data === 'playing' || event.data === 'paused') {
                    sessionStorage.setItem('musicState', event.data);
                    isPlaying = event.data === 'playing';
                    musicIcon.src = isPlaying ? './img/ui/music-on.png' : './img/ui/music-off.png';
                    musicIcon.alt = isPlaying ? '음악 중지' : '음악 재생';
                }
            });

            // 페이지 언로드 전에 현재 상태 저장
            window.addEventListener('beforeunload', () => {
                sessionStorage.setItem('musicState', isPlaying ? 'playing' : 'paused');
            });
        });

        // 업데이트 내역 로드
        let allUpdates = []; // 모든 업데이트 저장
        const INITIAL_SHOW = 4; // 처음에 보여줄 개수
        const LOAD_MORE_COUNT = 10; // 더보기 클릭시 추가할 개수
        let currentlyShown = 0;

        async function loadUpdates() {
            try {
                const response = await fetch('./data/updates.csv');
                const data = await response.text();
                
                // CSV 파싱
                allUpdates = data.split('\n')
                    .slice(1) // 헤더 제거
                    .filter(line => line.trim()) // 빈 줄 제거
                    .map(line => {
                        const [date, version, content] = line.split(',');
                        return { date, version, content: content.replace('|', ', ') };
                    });

                // 초기 업데이트 표시
                showMoreUpdates(INITIAL_SHOW);
                
                // 더보기 버튼 표시 여부 설정
                const showMoreBtn = document.getElementById('show-more-updates-btn');
                if (allUpdates.length > INITIAL_SHOW) {
                    showMoreBtn.style.display = 'block';
                    showMoreBtn.addEventListener('click', () => showMoreUpdates(LOAD_MORE_COUNT));
                }
            } catch (error) {
                console.error('업데이트 내역을 불러오는데 실패했습니다:', error);
            }
        }

        // 업데이트 추가 표시 함수
        function showMoreUpdates(count) {
            const updateList = document.getElementById('recent-update-list');
            const showMoreBtn = document.getElementById('show-more-updates-btn');
            
            // 추가로 표시할 업데이트들
            const newUpdates = allUpdates.slice(currentlyShown, currentlyShown + count);
            
            newUpdates.forEach(update => {
                const updateElement = document.createElement('div');
                updateElement.className = 'recent-update-content-text';
                updateElement.innerHTML = `
                    <div class="date">${update.date}</div>
                    <div class="version">${update.version}</div>
                    <div class="content"><p>${update.content}</p></div>
                `;
                updateList.appendChild(updateElement);
            });

            currentlyShown += newUpdates.length;

            // 모든 업데이트를 다 보여줬다면 더보기 버튼 숨기기
            if (currentlyShown >= allUpdates.length) {
                showMoreBtn.style.display = 'none';
            }
        }

        // 페이지 로드시 업데이트 내역 불러오기
        document.addEventListener('DOMContentLoaded', loadUpdates);
    </script>

</body>
</html>