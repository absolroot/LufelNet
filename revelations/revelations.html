<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>계시-루페르넷</title>
    <link rel="icon" type="image/x-icon" href="../img/ui/favicon.ico?v=1.0.1">
    <link rel="stylesheet" href="../styles/common.css">
    <link rel="stylesheet" href="../styles/revelations.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5862324369257695"
     crossorigin="anonymous"></script>
</head>
<body>
    <script src="../data/tooltip.js"></script>
    <script src="../js/tooltip.js"></script>

    <div class="container">
        <!-- 네비게이션이 삽입될 컨테이너 -->
        <div id="nav-container"></div>
        
        <!-- 메인 컨텐츠 -->
        <div class="main-wrapper">
            <!-- 네비게이션 경로 -->
            <div class="navigation-path">
                <a href="../index.html">홈</a>
                <span class="separator">/</span>
                <span class="current-page">계시</span>
            </div>
            <div class="header-container">
                <h1>계시</h1>
            </div>

            <!-- 필터 섹션 -->
            <div class="filter-section">
                <div class="filter-content">
                    <!-- 계시 타입 필터 -->
                    <div class="filter-group">
                        <h3>분류</h3>
                        <div class="filter-options">
                            <label>
                                <input type="checkbox" name="type" value="main">
                                <img src="../img/revelation/icon-주.png" alt="주 성위">
                            </label>
                            <label>
                                <input type="checkbox" name="type" value="sub">
                                <div class="sub-icons">
                                    <img src="../img/revelation/icon-일.png" alt="일월성진">
                                    <img src="../img/revelation/icon-월.png" alt="일월성진">
                                    <img src="../img/revelation/icon-성.png" alt="일월성진">
                                    <img src="../img/revelation/icon-진.png" alt="일월성진">
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!--구분선-->
            <div class="separator-line"></div>

            <!-- 계시 카드 컨테이너 -->
            <div class="revelation-cards" id="revelationCards">
                <!-- 자바스크립트로 동적 생성됨 -->
            </div>
        </div>
    </div>

    <script src="../js/nav.js"></script>
    <script src="../data/revelations.js"></script>
    <script>
        // 페이지 로드 시 네비게이션 초기화
        document.addEventListener('DOMContentLoaded', () => {
            Navigation.load('revelations', 1); // 현재 페이지에 맞는 active 상태 설정
            const cardsContainer = document.getElementById('revelationCards');
            
            // 주 계시와 일월성진 계시 분리
            const mainRevelations = Object.keys(revelationData.main);
            const subRevelations = Object.keys(revelationData.sub);
            
            // 모든 계시 배열 생성 (주 계시 먼저, 그 다음 일월성진 계시)
            const allRevelations = [
                ...mainRevelations.map(name => ({ name, type: 'main' })),
                ...subRevelations.map(name => ({ name, type: 'sub' }))
            ];
            
            // 각 계시에 대해 카드 생성
            allRevelations.forEach((revelation, index) => {
                // 7개의 카드마다 광고 삽입 (index는 0부터 시작하므로 7로 나눈 나머지가 7이면 8번째 카드)
                /*
                if (index > 0 && index % 7 === 0) {
                    const adContainer = document.createElement('div');
                    adContainer.className = 'card ad-card';
                    adContainer.innerHTML = `
                        <ins class="adsbygoogle"
                             style="display:block"
                             data-ad-format="fluid"
                             data-ad-layout-key="-fh+6+3e-os+119"
                             data-ad-client="ca-pub-5862324369257695"
                             data-ad-slot="7402083530"></ins>
                    `;
                    cardsContainer.appendChild(adContainer);
                    
                    // 새로운 광고 요소 초기화
                    (adsbygoogle = window.adsbygoogle || []).push({});
                }
                */

                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.type = revelation.type;
                card.dataset.name = revelation.name;
                
                // 이미지 컨테이너
                const imgContainer = document.createElement('div');
                imgContainer.className = 'img-container';
                
                // 계시 이미지
                const img = document.createElement('img');
                img.src = `../img/revelation/${revelation.name}.webp`;
                img.alt = revelation.name;
                img.className = 'revelation-img';

                // 이름 이미지
                const nameImg = document.createElement('img');
                nameImg.src = `../img/revelation/${revelation.name}.png`;
                nameImg.alt = revelation.name;
                nameImg.className = 'name-img';
                
                imgContainer.appendChild(img);
                imgContainer.appendChild(nameImg);
                
                // 정보 컨테이너
                const infoContainer = document.createElement('div');
                infoContainer.className = 'info-container';
                
                // 분류 표시
                const typeLabel = document.createElement('div');
                typeLabel.className = 'type-label';
                
                // 텍스트와 아이콘을 담을 컨테이너
                const typeLabelContent = document.createElement('div');
                typeLabelContent.className = 'type-label-content';
                
                // 텍스트 추가
                const typeText = document.createElement('span');
                typeText.textContent = revelation.name;  // 계시 이름으로 변경
                
                // 아이콘 컨테이너
                const iconContainer = document.createElement('div');
                iconContainer.className = 'type-icons';
                
                if (revelation.type === 'main') {
                    // 주 성위인 경우
                    const mainIcon = document.createElement('img');
                    mainIcon.src = '../img/revelation/icon-주.png';
                    mainIcon.alt = '주';
                    mainIcon.className = 'type-icon';
                    iconContainer.appendChild(mainIcon);
                } else {
                    // 일월성진인 경우
                    ['일', '월', '성', '진'].forEach(type => {
                        const icon = document.createElement('img');
                        icon.src = `../img/revelation/icon-${type}.png`;
                        icon.alt = type;
                        icon.className = 'type-icon';
                        iconContainer.appendChild(icon);
                    });
                }
                
                typeLabelContent.appendChild(typeText);
                typeLabelContent.appendChild(iconContainer);
                typeLabel.appendChild(typeLabelContent);
                
                // 효과 설명
                const effectsContainer = document.createElement('div');
                effectsContainer.className = 'effects-container';
                
                if (revelation.type === 'sub') {
                    // 일월성진 계시인 경우 2세트, 4세트 효과 표시
                    const effects = revelationData.sub_effects[revelation.name];
                    effectsContainer.innerHTML = `
                        <div class="effect-set">
                            <div class="set-label">2세트</div>
                            <div class="set-desc">${effects.set2}</div>
                        </div>
                        <div class="effect-set">
                            <div class="set-label">4세트</div>
                            <div class="set-desc">${effects.set4}</div>
                        </div>
                    `;
                } else {
                    // 주 계시인 경우 set_effects 표시
                    const mainEffects = revelationData.set_effects[revelation.name];
                    effectsContainer.innerHTML = Object.entries(mainEffects)
                        .map(([subName, effect]) => `
                            <div class="effect-set">
                                <div class="set-label">${subName}</div>
                                <div class="set-desc">${effect}</div>
                            </div>
                        `).join('');
                }
                
                infoContainer.appendChild(typeLabel);
                infoContainer.appendChild(effectsContainer);
                
                card.appendChild(imgContainer);
                card.appendChild(infoContainer);
                cardsContainer.appendChild(card);
            });
            
            addTooltips();

            // 필터링 기능 추가
            const checkboxes = document.querySelectorAll('.filter-options input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    applyFilters();
                });
            });

            function applyFilters() {
                const selectedTypes = Array.from(document.querySelectorAll('input[name="type"]:checked')).map(cb => cb.value);
                const cards = document.querySelectorAll('.card');
                
                cards.forEach(card => {
                    const type = card.dataset.type; // main 또는 sub
                    const typeMatch = selectedTypes.length === 0 || selectedTypes.includes(type);
                    
                    // display: none/block 대신 visibility와 opacity 사용
                    if (typeMatch) {
                        card.style.visibility = 'visible';
                        card.style.opacity = '1';
                        card.style.position = 'relative';
                        card.style.height = 'auto';
                    } else {
                        card.style.visibility = 'hidden';
                        card.style.opacity = '0';
                        card.style.position = 'absolute';
                        card.style.height = '0';
                    }
                });
            }

            let activeCard = null; // 현재 활성화된 카드 추적

            // 카드 클릭 이벤트 처리
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                card.addEventListener('click', (e) => {
                    e.stopPropagation(); // 이벤트 버블링 방지
                    const clickedName = card.getAttribute('data-name');
                    const cardType = card.getAttribute('data-type');

                    if (activeCard === card) {
                        // 같은 카드 다시 클릭 시 필터 해제
                        deactivateFilter();
                    } else {
                        // 다른 카드 클릭 시 필터 적용
                        activateFilter(card, clickedName, cardType);
                    }
                });
            });

            // 빈 공간 클릭 시 필터 해제
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.card')) {
                    deactivateFilter();
                }
            });

            function activateFilter(card, name, type) {
                // 이전 활성화 카드 스타일 제거
                if (activeCard) {
                    activeCard.classList.remove('active');
                }

                // 새 카드 활성화
                activeCard = card;
                card.classList.add('active');

                // 관련 계시 찾기
                let relatedRevelations = [];
                if (type === 'main') {
                    // 주 성위인 경우
                    relatedRevelations = revelationData.main[name] || [];
                    relatedRevelations.push(name); // 클릭한 카드도 포함
                } else if (type === 'sub') {
                    // 일월성진인 경우
                    relatedRevelations = revelationData.sub[name] || [];
                    relatedRevelations.push(name); // 클릭한 카드도 포함
                }

                // 카드 필터링 적용
                cards.forEach(c => {
                    const cardName = c.getAttribute('data-name');
                    const shouldShow = relatedRevelations.includes(cardName);

                    if (shouldShow) {
                        c.style.visibility = 'visible';
                        c.style.opacity = '1';
                        c.style.position = 'relative';
                        c.style.height = 'auto';
                    } else {
                        c.style.visibility = 'hidden';
                        c.style.opacity = '0';
                        c.style.position = 'absolute';
                        c.style.height = '0';
                    }
                });
            }

            function deactivateFilter() {
                // 활성화된 카드 스타일 제거
                if (activeCard) {
                    activeCard.classList.remove('active');
                    activeCard = null;
                }

                // 모든 카드 표시
                cards.forEach(card => {
                    card.style.visibility = 'visible';
                    card.style.opacity = '1';
                    card.style.position = 'relative';
                    card.style.height = 'auto';
                });
            }
        });
    </script>

    <script src="../js/top_button.js"></script>
    <button id="top-button" class="floating-top-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 4L4 12L5.4 13.4L11 7.8V20H13V7.8L18.6 13.4L20 12L12 4Z" fill="rgba(255, 255, 255, 0.6)"/>
        </svg>
    </button>

</body>
</html>